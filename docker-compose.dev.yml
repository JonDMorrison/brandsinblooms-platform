version: '3.8'

services:
  # Next.js development server
  nextjs:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.next
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_SUPABASE_URL=http://localhost:8000
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
      - WATCHPACK_POLLING=true # Enable polling for file changes in Docker
    depends_on:
      - kong
    command: pnpm dev

  # Include all Supabase services from the main docker-compose.yml
  db:
    extends:
      file: docker-compose.yml
      service: db

  studio:
    extends:
      file: docker-compose.yml
      service: studio

  kong:
    extends:
      file: docker-compose.yml
      service: kong

  auth:
    extends:
      file: docker-compose.yml
      service: auth

  rest:
    extends:
      file: docker-compose.yml
      service: rest

  realtime:
    extends:
      file: docker-compose.yml
      service: realtime

  storage:
    extends:
      file: docker-compose.yml
      service: storage

  imgproxy:
    extends:
      file: docker-compose.yml
      service: imgproxy

  meta:
    extends:
      file: docker-compose.yml
      service: meta

  edge-runtime:
    extends:
      file: docker-compose.yml
      service: edge-runtime

  mail:
    extends:
      file: docker-compose.yml
      service: mail

volumes:
  postgres_data:
    driver: local
  storage_data:
    driver: local

networks:
  default:
    driver: bridge