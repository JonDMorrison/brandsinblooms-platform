-- =====================================================
-- Brands in Blooms Platform - Comprehensive Seed Data
-- =====================================================
-- This file contains realistic test data for all tables
-- Run this after all migrations are complete
-- =====================================================

-- Enable required extensions
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- Clean up existing seed data (optional - comment out if preserving data)
/*
DELETE FROM site_metrics;
DELETE FROM activity_logs;
DELETE FROM order_items;
DELETE FROM orders;
DELETE FROM contact_inquiries;
DELETE FROM import_batches;
DELETE FROM media_files;
DELETE FROM taggings;
DELETE FROM tags;
DELETE FROM products;
DELETE FROM content;
DELETE FROM site_memberships;
DELETE FROM sites;
DELETE FROM profiles WHERE user_type != 'admin';
*/

-- =====================================================
-- 1. CREATE TEST USERS IN AUTH.USERS
-- =====================================================

-- Note: These need to be created via Supabase Auth Admin API or Dashboard
-- Here we'll assume they exist and just reference their IDs

-- Test user IDs - we'll use your existing admin user for site1 owner
-- First, let's create auth users and commit them
BEGIN;

-- Your existing user ID (admin)
DO $$
DECLARE
    admin_user_id UUID := '86e5fae8-203c-4cbe-9746-3389b4a05ee8';
    
    -- Site owner IDs - we'll create fake auth.users for these
    owner1_id UUID := admin_user_id;  -- Use your existing user for first site
    owner2_id UUID := 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11';
    owner3_id UUID := 'b0eebc99-9c0b-4ef8-bb6d-6bb9bd380a12';
    
    -- Customer IDs - we'll create fake auth.users for these
    customer1_id UUID := 'c0eebc99-9c0b-4ef8-bb6d-6bb9bd380a13';
    customer2_id UUID := 'd0eebc99-9c0b-4ef8-bb6d-6bb9bd380a14';
    customer3_id UUID := 'e0eebc99-9c0b-4ef8-bb6d-6bb9bd380a15';
    customer4_id UUID := 'f0eebc99-9c0b-4ef8-bb6d-6bb9bd380a16';
    customer5_id UUID := '10eebc99-9c0b-4ef8-bb6d-6bb9bd380a17';
    
    -- Site IDs
    site1_id UUID := gen_random_uuid();
    site2_id UUID := gen_random_uuid();
    site3_id UUID := gen_random_uuid();
    
    -- Product IDs for reference
    product1_id UUID := gen_random_uuid();
    product2_id UUID := gen_random_uuid();
    product3_id UUID := gen_random_uuid();
    
    -- Content IDs for reference
    content1_id UUID := gen_random_uuid();
    content2_id UUID := gen_random_uuid();
    
    -- Tag IDs
    tag1_id UUID := gen_random_uuid();
    tag2_id UUID := gen_random_uuid();
    tag3_id UUID := gen_random_uuid();
    
BEGIN
    -- =====================================================
    -- 1.5 CREATE AUTH USERS FOR TESTING
    -- =====================================================
    -- Create test users in auth.users table (skip if they already exist)
    -- Note: In production, users should be created through Supabase Auth
    
    -- Site owners
    INSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data, aud, role)
    SELECT owner2_id, 'michael@bloomboutique.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{}', 'authenticated', 'authenticated'
    WHERE NOT EXISTS (SELECT 1 FROM auth.users WHERE id = owner2_id);
    
    INSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data, aud, role)
    SELECT owner3_id, 'emma@naturesnook.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{}', 'authenticated', 'authenticated'
    WHERE NOT EXISTS (SELECT 1 FROM auth.users WHERE id = owner3_id);
    
    -- Customers
    INSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data, aud, role)
    SELECT customer1_id, 'alice@example.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{}', 'authenticated', 'authenticated'
    WHERE NOT EXISTS (SELECT 1 FROM auth.users WHERE id = customer1_id);
    
    INSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data, aud, role)
    SELECT customer2_id, 'bob@example.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{}', 'authenticated', 'authenticated'
    WHERE NOT EXISTS (SELECT 1 FROM auth.users WHERE id = customer2_id);
    
    INSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data, aud, role)
    SELECT customer3_id, 'sam@example.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{}', 'authenticated', 'authenticated'
    WHERE NOT EXISTS (SELECT 1 FROM auth.users WHERE id = customer3_id);
    
    INSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data, aud, role)
    SELECT customer4_id, 'diana@example.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{}', 'authenticated', 'authenticated'
    WHERE NOT EXISTS (SELECT 1 FROM auth.users WHERE id = customer4_id);
    
    INSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data, aud, role)
    SELECT customer5_id, 'james@example.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{}', 'authenticated', 'authenticated'
    WHERE NOT EXISTS (SELECT 1 FROM auth.users WHERE id = customer5_id);

    -- Wait a moment for triggers to fire
    PERFORM pg_sleep(0.1);
    
    -- Verify auth users were created
    IF NOT EXISTS (SELECT 1 FROM auth.users WHERE id = owner2_id) THEN
        RAISE NOTICE 'Warning: auth.users not created properly';
    END IF;

    -- =====================================================
    -- 2. UPDATE PROFILES (created by trigger)
    -- =====================================================
    
    -- Update existing admin profile to be a site owner  
    UPDATE public.profiles 
    SET 
        user_type = 'site_owner',
        username = 'greenthumb_gardens',
        full_name = 'Sarah Johnson (Admin)',
        bio = 'Owner of Green Thumb Gardens - Your local plant paradise!',
        avatar_url = 'https://api.dicebear.com/7.x/avataaars/svg?seed=callan',
        phone = '555-0101'
    WHERE user_id = owner1_id;
    
    -- Update profiles for other site owners (created by trigger)
    UPDATE public.profiles
    SET
        username = 'bloom_boutique',
        full_name = 'Michael Chen',
        phone = '555-0102',
        user_type = 'site_owner',
        bio = 'Passionate about bringing beauty to every home through plants.',
        avatar_url = 'https://api.dicebear.com/7.x/avataaars/svg?seed=michael'
    WHERE user_id = owner2_id;
    
    UPDATE public.profiles
    SET
        username = 'natures_nook',
        full_name = 'Emma Williams',
        phone = '555-0103',
        user_type = 'site_owner',
        bio = 'Certified horticulturist with 15 years of experience.',
        avatar_url = 'https://api.dicebear.com/7.x/avataaars/svg?seed=emma'
    WHERE user_id = owner3_id;

    -- =====================================================
    -- 3. UPDATE CUSTOMER PROFILES (created by trigger)
    -- =====================================================
    
    -- Update customer profiles with additional information
    UPDATE public.profiles SET username = 'plant_lover_23', full_name = 'Alice Cooper', phone = '555-1001', bio = 'Indoor plant enthusiast' WHERE user_id = customer1_id;
    UPDATE public.profiles SET username = 'garden_guru', full_name = 'Bob Martinez', phone = '555-1002', bio = 'Weekend gardener' WHERE user_id = customer2_id;
    UPDATE public.profiles SET username = 'succulent_sam', full_name = 'Sam Taylor', phone = '555-1003', bio = 'Succulent collector' WHERE user_id = customer3_id;
    UPDATE public.profiles SET username = 'flower_power', full_name = 'Diana Ross', phone = '555-1004', bio = 'Flower arrangement hobbyist' WHERE user_id = customer4_id;
    UPDATE public.profiles SET username = 'urban_farmer', full_name = 'James Park', phone = '555-1005', bio = 'Urban farming advocate' WHERE user_id = customer5_id;

    -- =====================================================
    -- 4. CREATE SITES
    -- =====================================================
    
    INSERT INTO public.sites (
        id, subdomain, name, description, logo_url, primary_color,
        business_name, business_email, business_phone, business_address,
        business_hours, latitude, longitude, timezone, is_active, is_published
    ) VALUES
        (
            site1_id,
            'greenthumb',
            'Green Thumb Gardens',
            'Your local source for quality plants, garden supplies, and expert advice since 1985.',
            'https://api.dicebear.com/7.x/shapes/svg?seed=greenthumb',
            '#10B981',
            'Green Thumb Gardens LLC',
            'info@greenthumbgardens.com',
            '555-0101',
            '123 Garden Way, Portland, OR 97201',
            '{"monday": "9:00 AM - 6:00 PM", "tuesday": "9:00 AM - 6:00 PM", "wednesday": "9:00 AM - 6:00 PM", "thursday": "9:00 AM - 7:00 PM", "friday": "9:00 AM - 7:00 PM", "saturday": "8:00 AM - 6:00 PM", "sunday": "10:00 AM - 5:00 PM"}'::jsonb,
            45.5152,
            -122.6784,
            'America/Los_Angeles',
            true,
            true
        ),
        (
            site2_id,
            'bloomboutique',
            'Bloom Boutique',
            'Curated selection of rare and exotic plants for the discerning plant parent.',
            'https://api.dicebear.com/7.x/shapes/svg?seed=bloom',
            '#EC4899',
            'Bloom Boutique Inc.',
            'hello@bloomboutique.com',
            '555-0102',
            '456 Flower St, San Francisco, CA 94102',
            '{"monday": "10:00 AM - 7:00 PM", "tuesday": "10:00 AM - 7:00 PM", "wednesday": "10:00 AM - 7:00 PM", "thursday": "10:00 AM - 8:00 PM", "friday": "10:00 AM - 8:00 PM", "saturday": "10:00 AM - 6:00 PM", "sunday": "11:00 AM - 5:00 PM"}'::jsonb,
            37.7749,
            -122.4194,
            'America/Los_Angeles',
            true,
            true
        ),
        (
            site3_id,
            'naturesnook',
            'Nature''s Nook',
            'Family-owned nursery specializing in native plants and sustainable gardening.',
            'https://api.dicebear.com/7.x/shapes/svg?seed=nature',
            '#059669',
            'Nature''s Nook Gardens',
            'contact@naturesnook.com',
            '555-0103',
            '789 Oak Grove Rd, Austin, TX 78701',
            '{"monday": "8:00 AM - 6:00 PM", "tuesday": "8:00 AM - 6:00 PM", "wednesday": "8:00 AM - 6:00 PM", "thursday": "8:00 AM - 6:00 PM", "friday": "8:00 AM - 7:00 PM", "saturday": "7:00 AM - 7:00 PM", "sunday": "9:00 AM - 5:00 PM"}'::jsonb,
            30.2672,
            -97.7431,
            'America/Chicago',
            true,
            true
        );

    -- Update theme settings for sites
    UPDATE public.sites
    SET theme_settings = 
        CASE subdomain
            WHEN 'greenthumb' THEN '{
                "colors": {"primary": "#10B981", "secondary": "#3B82F6", "accent": "#F59E0B", "background": "#FFFFFF"},
                "typography": {"headingFont": "Playfair Display", "bodyFont": "Inter", "fontSize": "medium"},
                "layout": {"headerStyle": "classic", "footerStyle": "detailed", "menuStyle": "horizontal"},
                "logo": {"url": null, "position": "left", "size": "medium"}
            }'::jsonb
            WHEN 'bloomboutique' THEN '{
                "colors": {"primary": "#EC4899", "secondary": "#8B5CF6", "accent": "#F472B6", "background": "#FDF2F8"},
                "typography": {"headingFont": "Cormorant Garamond", "bodyFont": "Source Sans Pro", "fontSize": "large"},
                "layout": {"headerStyle": "modern", "footerStyle": "minimal", "menuStyle": "horizontal"},
                "logo": {"url": null, "position": "center", "size": "large"}
            }'::jsonb
            WHEN 'naturesnook' THEN '{
                "colors": {"primary": "#059669", "secondary": "#10B981", "accent": "#84CC16", "background": "#F0FDF4"},
                "typography": {"headingFont": "Montserrat", "bodyFont": "Open Sans", "fontSize": "medium"},
                "layout": {"headerStyle": "rustic", "footerStyle": "newsletter", "menuStyle": "horizontal"},
                "logo": {"url": null, "position": "left", "size": "small"}
            }'::jsonb
        END;

    -- =====================================================
    -- 5. CREATE SITE MEMBERSHIPS
    -- =====================================================
    
    INSERT INTO public.site_memberships (user_id, site_id, role, is_active)
    VALUES
        (owner1_id, site1_id, 'owner', true),
        (owner2_id, site2_id, 'owner', true),
        (owner3_id, site3_id, 'owner', true);

    -- =====================================================
    -- 6. CREATE PRODUCTS
    -- =====================================================
    
    -- Green Thumb Gardens Products
    INSERT INTO public.products (
        id, site_id, sku, name, description, care_instructions,
        category, subcategory, price, sale_price, unit_of_measure,
        is_active, is_featured, in_stock, stock_status, slug,
        meta_description, attributes, images
    ) VALUES
        (
            product1_id,
            site1_id,
            'GTG-SUC-001',
            'Assorted Succulent Collection',
            'A beautiful collection of 6 different succulent varieties, perfect for beginners.',
            'Water sparingly, allowing soil to dry completely between waterings. Bright indirect light.',
            'Plants',
            'Succulents',
            29.99,
            24.99,
            'per collection',
            true,
            true,
            true,
            'in_stock',
            'assorted-succulent-collection',
            'Beautiful collection of 6 different succulent varieties, perfect for beginners and experts alike.',
            '{"light_requirements": "Bright indirect", "water_needs": "Low", "pet_friendly": true, "size": "2-4 inches"}'::jsonb,
            '[{"url": "https://images.unsplash.com/photo-1459156212016-c812468e2115", "alt": "Succulent collection", "is_primary": true}]'::jsonb
        ),
        (
            gen_random_uuid(),
            site1_id,
            'GTG-FER-002',
            'Boston Fern',
            'Classic houseplant with lush, feathery fronds that add tropical elegance to any space.',
            'Keep soil consistently moist. High humidity preferred. Indirect light.',
            'Plants',
            'Ferns',
            34.99,
            null,
            'per plant',
            true,
            false,
            true,
            'in_stock',
            'boston-fern',
            'Boston Fern - Classic houseplant with lush, feathery fronds.',
            '{"light_requirements": "Indirect", "water_needs": "High", "pet_friendly": true, "size": "12-18 inches"}'::jsonb,
            '[{"url": "https://images.unsplash.com/photo-1593691509543-c55fb32caba6", "alt": "Boston Fern", "is_primary": true}]'::jsonb
        ),
        (
            gen_random_uuid(),
            site1_id,
            'GTG-POT-003',
            'Ceramic Planter Set',
            'Set of 3 modern ceramic planters in varying sizes with drainage holes.',
            null,
            'Accessories',
            'Planters',
            45.99,
            null,
            'per set',
            true,
            true,
            true,
            'in_stock',
            'ceramic-planter-set',
            'Modern ceramic planter set - 3 sizes with drainage holes.',
            '{"material": "Ceramic", "colors": ["White", "Gray", "Terracotta"], "sizes": ["4 inch", "6 inch", "8 inch"], "drainage": true}'::jsonb,
            '[{"url": "https://images.unsplash.com/photo-1485955900006-10f4d324d411", "alt": "Ceramic planters", "is_primary": true}]'::jsonb
        );

    -- Bloom Boutique Products
    INSERT INTO public.products (
        site_id, sku, name, description, care_instructions,
        category, subcategory, price, unit_of_measure,
        is_active, is_featured, in_stock, stock_status, slug,
        attributes, images
    ) VALUES
        (
            site2_id,
            'BB-ORCH-001',
            'Phalaenopsis Orchid - Pink',
            'Elegant pink Phalaenopsis orchid in decorative pot. Blooms last 2-3 months.',
            'Water weekly by soaking. Bright indirect light. Maintain humidity.',
            'Plants',
            'Orchids',
            89.99,
            'per plant',
            true,
            true,
            true,
            'in_stock',
            'pink-phalaenopsis-orchid',
            '{"light_requirements": "Bright indirect", "water_needs": "Medium", "pet_friendly": false, "bloom_color": "Pink", "bloom_duration": "2-3 months"}'::jsonb,
            '[{"url": "https://images.unsplash.com/photo-1520412099551-62b6bafeb5bb", "alt": "Pink orchid", "is_primary": true}]'::jsonb
        ),
        (
            site2_id,
            'BB-RARE-002',
            'Monstera Albo Variegata',
            'Rare variegated Monstera with stunning white and green leaves. Limited availability.',
            'Water when top inch of soil is dry. Bright indirect light. Support with moss pole.',
            'Plants',
            'Rare Plants',
            299.99,
            'per plant',
            true,
            true,
            false,
            'limited_stock',
            'monstera-albo-variegata',
            '{"light_requirements": "Bright indirect", "water_needs": "Medium", "pet_friendly": false, "variegation": "High", "size": "10-12 inches"}'::jsonb,
            '[{"url": "https://images.unsplash.com/photo-1614594975525-e45190c55d0b", "alt": "Variegated Monstera", "is_primary": true}]'::jsonb
        );

    -- Nature's Nook Products
    INSERT INTO public.products (
        id, site_id, sku, name, description, care_instructions,
        category, subcategory, price, unit_of_measure,
        is_active, is_featured, in_stock, stock_status, slug,
        attributes, images
    ) VALUES
        (
            product2_id,
            site3_id,
            'NN-NAT-001',
            'Texas Sage (Cenizo)',
            'Native Texas shrub with silvery foliage and tubular pink flowers. Drought tolerant.',
            'Full sun. Water deeply but infrequently once established. Prune after flowering.',
            'Plants',
            'Native Plants',
            24.99,
            'per plant',
            true,
            true,
            true,
            'in_stock',
            'texas-sage-cenizo',
            '{"light_requirements": "Full sun", "water_needs": "Low", "native_to": "Texas", "bloom_season": "Summer-Fall", "mature_size": "4-8 feet"}'::jsonb,
            '[{"url": "https://images.unsplash.com/photo-1593600356438-f8ec6f3df7d6", "alt": "Texas Sage", "is_primary": true}]'::jsonb
        ),
        (
            product3_id,
            site3_id,
            'NN-SEED-002',
            'Wildflower Seed Mix - Texas Native',
            'Premium blend of 15+ native Texas wildflower species. Covers 500 sq ft.',
            'Scatter in fall or early spring. Water until established.',
            'Seeds',
            'Wildflower Seeds',
            19.99,
            'per package',
            true,
            false,
            true,
            'in_stock',
            'texas-wildflower-seed-mix',
            '{"coverage": "500 sq ft", "species_count": "15+", "bloom_time": "Spring", "includes": ["Bluebonnet", "Indian Paintbrush", "Black-eyed Susan"]}'::jsonb,
            '[{"url": "https://images.unsplash.com/photo-1590160301862-0fa3c0a1a216", "alt": "Wildflower field", "is_primary": true}]'::jsonb
        );

    -- =====================================================
    -- 7. CREATE TAGS
    -- =====================================================
    
    INSERT INTO public.tags (id, site_id, name, slug, description)
    VALUES
        (tag1_id, site1_id, 'Beginner Friendly', 'beginner-friendly', 'Perfect for those new to plant care'),
        (tag2_id, site1_id, 'Pet Safe', 'pet-safe', 'Non-toxic to cats and dogs'),
        (tag3_id, site1_id, 'Low Light', 'low-light', 'Thrives in low light conditions'),
        (gen_random_uuid(), site2_id, 'Rare Find', 'rare-find', 'Limited availability exotic plants'),
        (gen_random_uuid(), site2_id, 'Air Purifying', 'air-purifying', 'Helps clean indoor air'),
        (gen_random_uuid(), site3_id, 'Native', 'native', 'Indigenous to local ecosystem'),
        (gen_random_uuid(), site3_id, 'Drought Tolerant', 'drought-tolerant', 'Requires minimal watering');

    -- =====================================================
    -- 8. CREATE TAGGINGS
    -- =====================================================
    
    INSERT INTO public.taggings (tag_id, taggable_id, taggable_type)
    VALUES
        (tag1_id, product1_id, 'product'),
        (tag2_id, product1_id, 'product');

    -- =====================================================
    -- 9. CREATE CONTENT
    -- =====================================================
    
    -- Green Thumb Gardens Content (author_id will be set later)
    INSERT INTO public.content (
        id, site_id, author_id, content_type, title, slug, content,
        meta_data, is_published, is_featured, published_at
    ) VALUES
        (
            content1_id,
            site1_id,
            NULL, -- Will update after auth users are verified
            'blog_post',
            '10 Essential Tips for Indoor Plant Care',
            '10-essential-tips-indoor-plant-care',
            '{"blocks": [{"type": "paragraph", "content": "Indoor plants can transform your living space into a vibrant, healthy environment. Here are our top 10 tips for keeping your indoor plants thriving..."}]}'::jsonb,
            '{"excerpt": "Master the art of indoor plant care with these essential tips.", "read_time": "5 min"}'::jsonb,
            true,
            true,
            NOW() - INTERVAL '5 days'
        ),
        (
            content2_id,
            site1_id,
            NULL, -- Will update after auth users are verified
            'page',
            'About Us',
            'about',
            '{"blocks": [{"type": "heading", "content": "Our Story"}, {"type": "paragraph", "content": "Green Thumb Gardens has been serving Portland plant lovers since 1985..."}]}'::jsonb,
            '{"page_order": 1}'::jsonb,
            true,
            false,
            NOW() - INTERVAL '30 days'
        ),
        (
            gen_random_uuid(),
            site1_id,
            NULL, -- Will update after auth users are verified
            'event',
            'Spring Plant Sale - 20% Off Everything!',
            'spring-plant-sale-2024',
            '{"blocks": [{"type": "paragraph", "content": "Join us for our annual Spring Plant Sale! Everything in the store will be 20% off."}]}'::jsonb,
            '{"event_date": "2024-04-15T09:00:00Z", "event_end_date": "2024-04-16T18:00:00Z", "location": "All locations"}'::jsonb,
            true,
            true,
            NOW() - INTERVAL '2 days'
        );

    -- Bloom Boutique Content  
    INSERT INTO public.content (
        site_id, author_id, content_type, title, slug, content,
        meta_data, is_published, published_at
    ) VALUES
        (
            site2_id,
            NULL, -- Will update after auth users are verified
            'blog_post',
            'Rare Plant Spotlight: Caring for Variegated Monsteras',
            'rare-plant-spotlight-variegated-monsteras',
            '{"blocks": [{"type": "paragraph", "content": "Variegated Monsteras are the crown jewels of many plant collections..."}]}'::jsonb,
            '{"excerpt": "Everything you need to know about caring for these stunning plants.", "read_time": "8 min"}'::jsonb,
            true,
            NOW() - INTERVAL '7 days'
        );
        
    -- Update content with author IDs after verifying users exist
    UPDATE public.content SET author_id = owner1_id WHERE site_id = site1_id;
    UPDATE public.content SET author_id = owner2_id WHERE site_id = site2_id;

    -- =====================================================
    -- 10. CREATE ORDERS
    -- =====================================================
    
    INSERT INTO public.orders (
        site_id, customer_id, order_number, status, total_amount,
        items_count, customer_name, customer_email, created_at
    ) VALUES
        (site1_id, customer1_id, 'GTG-20240125-001', 'delivered', 75.98, 2, 'Alice Cooper', 'alice@example.com', NOW() - INTERVAL '15 days'),
        (site1_id, customer2_id, 'GTG-20240128-002', 'shipped', 45.99, 1, 'Bob Martinez', 'bob@example.com', NOW() - INTERVAL '3 days'),
        (site1_id, customer3_id, 'GTG-20240130-003', 'processing', 29.99, 1, 'Sam Taylor', 'sam@example.com', NOW() - INTERVAL '1 day'),
        (site2_id, customer4_id, 'BB-20240129-001', 'delivered', 89.99, 1, 'Diana Ross', 'diana@example.com', NOW() - INTERVAL '5 days'),
        (site3_id, customer5_id, 'NN-20240130-001', 'processing', 44.98, 2, 'James Park', 'james@example.com', NOW() - INTERVAL '2 hours');

    -- =====================================================
    -- 11. CREATE ORDER ITEMS
    -- =====================================================
    
    INSERT INTO public.order_items (
        order_id, product_id, product_name, product_sku,
        quantity, unit_price, total_price
    )
    SELECT 
        o.id,
        p.id,
        p.name,
        p.sku,
        1,
        p.price,
        p.price
    FROM orders o
    JOIN products p ON p.site_id = o.site_id
    WHERE o.order_number = 'GTG-20240125-001'
    LIMIT 2;

    -- =====================================================
    -- 12. CREATE CONTACT INQUIRIES
    -- =====================================================
    
    INSERT INTO public.contact_inquiries (
        site_id, inquiry_type, name, email, phone,
        subject, message, status, created_at
    ) VALUES
        (
            site1_id,
            'general',
            'John Smith',
            'john.smith@email.com',
            '555-2001',
            'Question about plant care workshop',
            'Hi, I was wondering if you offer any weekend workshops for beginners?',
            'responded',
            NOW() - INTERVAL '3 days'
        ),
        (
            site2_id,
            'product',
            'Mary Johnson',
            'mary.j@email.com',
            '555-2002',
            'Monstera Albo availability',
            'When will you have more Monstera Albo in stock?',
            'new',
            NOW() - INTERVAL '4 hours'
        );

    -- =====================================================
    -- 13. CREATE MEDIA FILES
    -- =====================================================
    
    INSERT INTO public.media_files (
        site_id, uploaded_by, file_name, file_url,
        file_type, file_size_bytes, alt_text
    ) VALUES
        (site1_id, owner1_id, 'workshop-banner.jpg', 'https://storage.example.com/site1/workshop-banner.jpg', 'image', 250000, 'Plant care workshop banner'),
        (site1_id, owner1_id, 'store-front.jpg', 'https://storage.example.com/site1/store-front.jpg', 'image', 450000, 'Green Thumb Gardens storefront'),
        (site2_id, owner2_id, 'rare-plants-guide.pdf', 'https://storage.example.com/site2/rare-plants-guide.pdf', 'document', 1500000, 'Rare plants care guide');

    -- =====================================================
    -- 14. CREATE ACTIVITY LOGS
    -- =====================================================
    
    INSERT INTO public.activity_logs (
        site_id, user_id, activity_type, entity_type, entity_id,
        title, description, metadata, created_at
    ) VALUES
        (site1_id, owner1_id, 'product_update', 'products', product1_id, 'Product Updated', 'Updated Succulent Collection pricing', '{"old_price": 29.99, "new_price": 24.99}'::jsonb, NOW() - INTERVAL '2 days'),
        (site1_id, owner1_id, 'content_publish', 'content', content1_id, 'Blog Post Published', 'Published "10 Essential Tips for Indoor Plant Care"', '{}'::jsonb, NOW() - INTERVAL '5 days'),
        (site2_id, owner2_id, 'order_status', 'orders', gen_random_uuid(), 'Order Shipped', 'Order BB-20240129-001 marked as shipped', '{"tracking": "1Z999999999"}'::jsonb, NOW() - INTERVAL '4 days');

    -- =====================================================
    -- 15. CREATE SITE METRICS
    -- =====================================================
    
    -- Green Thumb Gardens metrics for last 7 days
    INSERT INTO public.site_metrics (site_id, metric_date, metrics)
    SELECT 
        site1_id,
        CURRENT_DATE - i,
        jsonb_build_object(
            'performance', jsonb_build_object('score', 85 + (random() * 10)::int, 'change', (random() * 10 - 5)::int, 'trend', CASE WHEN random() > 0.5 THEN 'up' ELSE 'down' END),
            'page_load', jsonb_build_object('score', 90 + (random() * 8)::int, 'change', (random() * 6 - 3)::int, 'trend', CASE WHEN random() > 0.5 THEN 'up' ELSE 'down' END),
            'seo', jsonb_build_object('score', 75 + (random() * 15)::int, 'change', (random() * 8 - 4)::int, 'trend', CASE WHEN random() > 0.5 THEN 'up' ELSE 'down' END),
            'mobile', jsonb_build_object('score', 88 + (random() * 10)::int, 'change', (random() * 5 - 2)::int, 'trend', CASE WHEN random() > 0.3 THEN 'up' WHEN random() > 0.6 THEN 'down' ELSE 'neutral' END),
            'security', jsonb_build_object('score', 95 + (random() * 5)::int, 'change', (random() * 3)::int, 'trend', 'up'),
            'accessibility', jsonb_build_object('score', 70 + (random() * 20)::int, 'change', (random() * 10 - 5)::int, 'trend', CASE WHEN random() > 0.5 THEN 'up' ELSE 'down' END)
        )
    FROM generate_series(0, 6) AS i;

    -- Bloom Boutique metrics
    INSERT INTO public.site_metrics (site_id, metric_date, metrics)
    VALUES
        (
            site2_id,
            CURRENT_DATE,
            '{
                "performance": {"score": 92, "change": 3, "trend": "up"},
                "page_load": {"score": 95, "change": 2, "trend": "up"},
                "seo": {"score": 88, "change": -1, "trend": "down"},
                "mobile": {"score": 90, "change": 0, "trend": "neutral"},
                "security": {"score": 98, "change": 1, "trend": "up"},
                "accessibility": {"score": 85, "change": 5, "trend": "up"}
            }'::jsonb
        );

    -- =====================================================
    -- 16. CREATE IMPORT BATCH RECORDS
    -- =====================================================
    
    INSERT INTO public.import_batches (
        site_id, imported_by, file_name, file_type,
        total_rows, successful_rows, failed_rows,
        status, created_at, completed_at
    ) VALUES
        (
            site1_id,
            owner1_id,
            'spring_inventory_2024.csv',
            'csv',
            150,
            148,
            2,
            'completed',
            NOW() - INTERVAL '10 days',
            NOW() - INTERVAL '10 days' + INTERVAL '5 minutes'
        );

END $$;

COMMIT;

-- =====================================================
-- FINAL VERIFICATION QUERIES
-- =====================================================

-- Verify data was inserted
DO $$
BEGIN
    RAISE NOTICE 'Seed data insertion complete!';
    RAISE NOTICE 'Profiles: %', (SELECT COUNT(*) FROM profiles);
    RAISE NOTICE 'Sites: %', (SELECT COUNT(*) FROM sites);
    RAISE NOTICE 'Products: %', (SELECT COUNT(*) FROM products);
    RAISE NOTICE 'Orders: %', (SELECT COUNT(*) FROM orders);
    RAISE NOTICE 'Content: %', (SELECT COUNT(*) FROM content);
    RAISE NOTICE 'Tags: %', (SELECT COUNT(*) FROM tags);
END $$;